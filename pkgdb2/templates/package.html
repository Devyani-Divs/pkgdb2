{% extends "master.html" %}

{% block title %} {{ package.name }} | PkgDB {% endblock %}

{%block tag %}packages{% endblock %}

{% set options = True %}
{% block options_title %}Package Status{% endblock %}
{%block options %}
<table id="metainfo">
    <tr>
        <th>Status</th>
        <td>{{ package.status }}</td>
    </tr>
    <tr>
        <th>Created on</th>
        <td property="doap:created">{{ package.date_created.strftime('%Y-%m-%d') }}</td>
    </tr>
</table>
{% endblock %}

{% block content %}

<section id="pkg_info">
  <h1 property="doap:name">{{ package.name }}</h1>

  <p property="doap:shortdesc">{{ package.summary }}</p>

  {% if package.description %}
  <p id="description" property="doap:description">{{ package.description }}</p>
  {% endif %}

  <ul id="actions">
      <li>
          <a href="http://koji.fedoraproject.org/koji/search?type=package&match=glob&terms={{ package.name }}"
          class="koji">
          Builds status</a>
      </li>
      <li>
          <a href="https://admin.fedoraproject.org/updates/{{ package.name }}"
          class="bodhi">
          Updates status</a>
      </li>
      <li>
          <a href="http://pkgs.fedoraproject.org/cgit/{{ package.name }}.git/"
          class="cvs">
          Package source</a>
      </li>
      <li>
          <a href="https://apps.fedoraproject.org/packages/{{ package.name }}/bugs"
          class="bugz">
          Bugs reports</a>
      </li>
      <li>
      {% if package.review_url %}
          <a href="{{ package.review_url }}" class="bugz">
          Package review</a>
      {% else %}
          Package review unknown
      {% endif %}
      </li>

  </ul>

  <div class="h_line"></div>

  <section id="pkg_ppl_table">
    <div class="pkg_ppl_row">
      <div id="pkg_contacts">
        <h4>Main Contact(s)</h4>
          <p>
            For general concerns about this package, these are the people to
            contact.
          </p>
          <ul>
            {% for user in branch_poc %}
            <li>
              <span class="username">
                <a href="{{ url_for('.packager_info', packager=user) }}">
                  {{ user }}
                </a>
              </span>
              <span class="branches">({{ branch_poc[user] | sort | join(', ') }})</span>
            </li>
            {% endfor %}
          </ul>
      </div>

      <div id="pkg_admins">
        <h4>Package Administrator(s)</h4>
          <p>
            These users can help you if you need commit privileges for this
            package.
          </p>
          <ul>
            {% for user in branch_poc %}
            <li>
              <span class="username">
                <a href="{{ url_for('.packager_info', packager=user) }}">
                  {{ user }}
                </a>
              </span>
              <span class="branches">({{ branch_poc[user] | sort | join(', ') }})</span>
            </li>
            {% endfor %}
          </ul>
      </div>
    </div>
  </section>

  <div class="h_line"></div>

  <section id="pkg_committers">
    <h3>Committer(s)</h3>

    <table>
      <tr>
        <th></th>
        {% for branch in branches | sort %}
        <th>{{ branch }}</th>
        {% endfor %}
      </tr>
      {% for user in commit_acls | sort %}
        {% if loop.last %}
          <tr class="lastrow">
        {% else %}
          <tr>
        {% endif %}
          <td class="users">
            <a href="{{ url_for('.packager_info', packager=user) }}" class="username">
              {{ user }}
            </a>
          </td>
          {% for branch in branches | sort %}
            {% if not loop.last %}
              <td class="dashed">
            {% else %}
              <td class="dashed lastcel">
            {% endif %}
              {% if 'commit' in commit_acls[user][branch]
                  and commit_acls[user][branch]['commit'] %}
                <img src="{{ url_for('static',
                    filename='%s.png' % commit_acls[user][branch]['commit']) }}"
                  title="ACL {{ commit_acls[user][branch]['commit'] }}"
                  alt="{{ commit_acls[user][branch]['commit'] }}"/ >
                {{ commit_acls[user][branch]['commit'] }}
              {% endif %}
            </td>
          {% endfor %}
        </tr>
      {% endfor %}
    </table>
  </section>

  <div class="h_line"></div>

  <section id="pkg_watchers">
    <h3>Watcher(s)</h3>

    <table>
      <tr>
        <th></th>
        {% for branch in branches | sort %}
        <th colspan="2">{{ branch }}</th>
        {% endfor %}
      </tr>
      <tr>
        <th></th>
        {% for branch in branches  %}
          {% for acl in ['Bugs', 'Commits'] %}
            <th class="headings ">{{ acl }}</th>
          {% endfor %}
        {% endfor %}
      </tr>
      {% for user in watch_acls | sort %}
        {% if loop.last %}
          <tr class="lastrow {{ loop.cycle('row_odd', 'row_even') }}">
        {% else %}
          <tr class="{{ loop.cycle('row_odd', 'row_even') }}">
        {% endif %}
          <td>
            <a href="{{ url_for('.packager_info', packager=user) }}"
              class="username">
              {{ user }}
            </a>
          </td>
          {% for branch in branches | sort %}
            {% set coltype = loop.cycle('col_odd', 'col_even') %}
            {% if loop.last %}
              {% set last = True %}
            {% else %}
              {% set last = False %}
            {% endif %}
            {% for acl in ['watchbugzilla', 'watchcommits'] %}
              {% if loop.first %}
                <td class="{{ coltype }}">
              {% elif last %}
                <td class="dashed lastcel {{ coltype }}">
              {% else %}
                <td class="dashed {{ coltype }}">
              {% endif %}
                {% if acl in watch_acls[user][branch]
                    and watch_acls[user][branch][acl] == 'Approved' %}
                  <img src="{{ url_for('static', filename='watch_20.png') }}"
                    alt="Approved" title="Approve"/>
                {% endif %}
              </td>
            {% endfor %}
          {% endfor %}
        </tr>
      {% endfor %}
    </table>
  </section>

</section>
{% endblock %}
